For each interval, accumulate the count: count++ for interval start, and count-- for interval end. Use a map to associate the point and count.

For a given number, use binary search which return the index that is just smaller or equal to the target.

